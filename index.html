<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English-5-Speaking</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&family=Pangolin&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A90E2; --secondary: #6C5CE7; --accent: #27AE60;
            --error: #FF7F50; --bg: #F0F4F8; --white: #FFFFFF; --gold: #F1C40F;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Lexend', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #2D3436; line-height: 1.5; }
        
        .container { max-width: 500px; margin: auto; background: var(--white); padding: 20px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        .header-title { text-align: center; color: var(--primary); font-family: 'Pangolin', cursive; font-size: 2.2rem; margin: 10px 0; }
        
        .mode-switch { display: flex; gap: 8px; margin-bottom: 20px; background: #EBF2F9; padding: 5px; border-radius: 50px; }
        .mode-btn { flex: 1; padding: 12px 5px; border: none; border-radius: 40px; cursor: pointer; font-weight: bold; font-family: inherit; font-size: 0.9rem; transition: 0.3s; }
        .mode-btn.active { background: var(--primary); color: white; }

        .input-bar { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #E0E7ED; font-family: inherit; font-size: 16px; outline: none; }

        .card { background: #F9FBFF; padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #E6EEF5; }
        .sample-box { background: white; padding: 15px; border-radius: 15px; border-left: 6px solid var(--accent); margin: 10px 0; font-size: 1rem; color: #34495E; }
        
        .btn-record { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; padding: 18px; border-radius: 50px; font-size: 1.2rem; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); }
        .btn-listen { background: white; color: var(--primary); border: 2px solid var(--primary); padding: 8px 20px; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; }

        .feedback-area { background: #FFF; padding: 20px; border-radius: 20px; border: 2px dashed #BDC3C7; margin-top: 20px; }
        .correct { color: var(--accent); font-weight: bold; }
        .fix { color: var(--error); text-decoration: underline; font-weight: bold; }
        .suggestion-box { margin-top: 10px; padding: 15px; background: #E8F4FD; border-radius: 15px; font-size: 0.95rem; }

        /* Certificate Mobile Optimized */
        #cert {
            display: none; margin-top: 30px; padding: 25px 15px; border: 8px solid #FDCB6E;
            background: #FFFEF9; text-align: center; border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .cert-head { font-family: 'Pangolin', cursive; font-size: 2.2rem; color: #B8860B; margin: 0; }
        .cert-name { font-size: 1.8rem; color: var(--secondary); border-bottom: 2px solid #DDD; display: inline-block; margin: 15px 0; font-family: 'Pangolin', cursive; }
        .stars { font-size: 2.5rem; color: var(--gold); margin: 10px 0; letter-spacing: 5px; }
        .footer-sig { display: flex; flex-direction: column; gap: 20px; margin-top: 30px; align-items: center; }
        .signature { border-top: 1px solid #95A5A6; width: 80%; padding-top: 5px; font-style: italic; font-size: 1.1rem; font-family: 'Pangolin', cursive; }

        @media (min-width: 600px) {
            .container { max-width: 800px; padding: 40px; }
            .input-bar { flex-direction: row; }
            .footer-sig { flex-direction: row; justify-content: space-around; }
            .signature { width: 250px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-title">English-5-Speaking</div>

    <div class="mode-switch">
        <button id="btnUnit" class="mode-btn active" onclick="setMode('unit')">H·ªçc Unit</button>
        <button id="btnFree" class="mode-btn" onclick="setMode('free')">N√≥i T·ª± Do</button>
    </div>

    <div class="input-bar">
        <input type="text" id="nameInp" placeholder="T√™n c·ªßa con...">
        <input type="text" id="classInp" placeholder="L·ªõp (Vd: 5/3)">
    </div>

    <div id="unitSection" class="card">
        <select id="unitSel" onchange="changeUnit()"></select>
        <div class="sample-box" id="sampleTxt"></div>
        <button class="btn-listen" onclick="playVoice(document.getElementById('sampleTxt').innerText)">üîä Nghe c√¥ ƒë·ªçc m·∫´u</button>
    </div>

    <div id="freeSection" class="card" style="display:none">
        <div class="sample-box"><b>C√¥ AI:</b> Con h√£y n√≥i v·ªÅ ∆∞·ªõc m∆° c·ªßa m√¨nh nh√©! C√¥ s·∫Ω s·ª≠a l·ªói cho con.</div>
    </div>

    <div class="card" style="padding: 10px;">
        <textarea id="output" rows="3" placeholder="L·ªùi con n√≥i hi·ªán ·ªü ƒë√¢y..."></textarea>
        <button class="btn-record" id="recBtn" onclick="startRec()">üéôÔ∏è NH·∫§N ƒê·ªÇ N√ìI</button>
    </div>

    <div class="feedback-area" id="feedback">
        <div id="fbContent" style="font-size: 0.95rem;">ƒêang ƒë·ª£i con luy·ªán t·∫≠p...</div>
    </div>

    <div id="cert">
        <div class="cert-head">CERTIFICATE</div>
        <p style="font-size: 0.9rem; color: #7F8C8D; margin: 5px 0;">EXCELLENT PERFORMANCE</p>
        <div class="cert-name" id="cName">Super Star</div>
        <p style="font-size: 1rem; margin: 5px 0;">L·ªõp: <span id="cClass">...</span></p>
        <h2 id="cUnit" style="color:#D4AF37; font-size: 1.4rem; margin: 10px 0;">UNIT 1</h2>
        <div class="stars" id="cStars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <div class="footer-sig">
            <div class="signature">Mrs Tran Thi Kim Yen</div>
            <div class="signature">Mrs Pham Thi Ngoc Bich</div>
        </div>
    </div>
</div>

<script>
const lessons = {
    1: { t: "Unit 1: All about me!", s: "I‚Äôm Hoang. I‚Äôm in class 5/3. I live in the countryside. My favourite colour is yellow. My favourite animal is a dolphin. My favourite food is a sandwich. My favourite sport is table tennis." },
    2: { t: "Unit 2: Our homes", s: "I live in a flat. My address is 65 Le Loi Street. It is a big and modern building in the city." },
    3: { t: "Unit 3: My foreign friends", s: "He is Vietnamese. She is American. He is active and friendly. She is clever and helpful." },
    4: { t: "Unit 4: Our free-time activities", s: "I like watering the flowers and playing the violin in my free time. At the weekend, I always read books and surf the Internet." },
    5: { t: "Unit 5: My future job", s: "I‚Äôd like to be a teacher because I‚Äôd like to teach children. My brother wants to be a doctor to help people." },
    6: { t: "Unit 6: Our school rooms", s: "The art room is on the second floor. Go past the library and turn right. It is very beautiful." },
    7: { t: "Unit 7: Our favourite school activities", s: "He likes solving maths problems because it is interesting. We love doing school projects together." },
    8: { t: "Unit 8: In our classroom", s: "The crayons are on the table. The glue sticks are beside the books. This pencil sharpener is mine." },
    9: { t: "Unit 9: Our outdoor activities", s: "We were at the campsite last week. We danced around the campfire and watched the fish in the pond." },
    10: { t: "Unit 10: Our school trip", s: "They went to Ba Na Hills last month. They visited the old buildings and took many beautiful photos." },
    11: { t: "Unit 11: Family time", s: "I swam in the sea with my family. We took a boat trip around the bay and ate delicious seafood." },
    12: { t: "Unit 12: Our Tet holiday", s: "I will make banh chung and decorate my house. I will visit my grandparents and get lucky money." },
    13: { t: "Unit 13: Our special days", s: "On Children's Day, we will sing and dance. We will have pizza and milk tea at the party." },
    14: { t: "Unit 14: Staying healthy", s: "She does yoga once a week to stay healthy. She does morning exercise and eats healthy food." },
    15: { t: "Unit 15: Our health", s: "I have a sore throat and a fever. You should go to the doctor and rinse your mouth with salt water." },
    16: { t: "Unit 16: Seasons and the weather", s: "It is hot and sunny in summer. I usually wear a blouse and trousers. It is cold in winter." },
    17: { t: "Unit 17: Stories for children", s: "The fox is clever and the crow is greedy. The tortoise ran fast and worked hard to win the race." },
    18: { t: "Unit 18: Means of transport", s: "I want to visit Dragon Bridge. You can get there by bus or by taxi. It is fantastic." },
    19: { t: "Unit 19: Places of interest", s: "I think Hoi An Old Town is peaceful. It is about twenty-nine kilometres from Da Nang." },
    20: { t: "Unit 20: Our summer holidays", s: "I am going to visit Phong Nha Cave this summer. I am going to go camping and join a music club." }
};

let currentMode = 'unit';
const sel = document.getElementById('unitSel');
for(let i in lessons) sel.innerHTML += `<option value="${i}">${lessons[i].t}</option>`;

function setMode(m) {
    currentMode = m;
    document.getElementById('btnUnit').classList.toggle('active', m === 'unit');
    document.getElementById('btnFree').classList.toggle('active', m === 'free');
    document.getElementById('unitSection').style.display = m === 'unit' ? 'block' : 'none';
    document.getElementById('freeSection').style.display = m === 'free' ? 'block' : 'none';
    document.getElementById('cert').style.display = 'none';
}

function changeUnit() {
    document.getElementById('sampleTxt').innerText = lessons[sel.value].s;
    document.getElementById('cert').style.display = 'none';
}
changeUnit();

function playVoice(text) {
    window.speechSynthesis.cancel();
    let utter = new SpeechSynthesisUtterance(text);
    let voices = window.speechSynthesis.getVoices();
    // Gi·ªçng UK gi√∫p ph√°t √¢m "live" l√† /liv/ chu·∫©n x√°c
    utter.voice = voices.find(v => v.lang === 'en-GB' && v.name.includes('Female')) || voices.find(v => v.lang === 'en-GB') || voices[0];
    utter.rate = 0.8; 
    window.speechSynthesis.speak(utter);
}

const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!Speech) {
    alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i. H√£y d√πng Chrome ho·∫∑c Safari m·ªõi nh·∫•t nh√©!");
}
const rec = new Speech();
rec.lang = 'en-US';
rec.continuous = false;

function startRec() {
    try { rec.start(); document.getElementById('recBtn').innerText = "üî¥ ƒêANG NGHE..."; } 
    catch(e) { console.log(e); }
}

rec.onresult = (e) => {
    const said = e.results[0][0].transcript;
    document.getElementById('output').value = said;
    document.getElementById('recBtn').innerText = "üéôÔ∏è NH·∫§N ƒê·ªÇ N√ìI";
    if (currentMode === 'unit') analyzeUnit(said); else analyzeFree(said);
};

rec.onerror = () => { document.getElementById('recBtn').innerText = "üéôÔ∏è NH·∫§N ƒê·ªÇ N√ìI"; };

function analyzeUnit(said) {
    let sample = lessons[sel.value].s.toLowerCase().replace(/[.,!]/g,"");
    let input = said.toLowerCase().replace(/[.,!]/g,"");
    let sArr = sample.split(" ");
    let iArr = input.split(" ");
    let html = ""; let mistakes = 0;
    
    sArr.forEach(word => {
        if (iArr.includes(word)) html += `<span class="correct">${word}</span> `;
        else { html += `<span class="fix" onclick="playVoice('${word}')">${word}</span> `; mistakes++; }
    });

    document.getElementById('fbContent').innerHTML = `<p><b>K·∫øt qu·∫£:</b> (Ch·∫°m t·ª´ m√†u cam ƒë·ªÉ nghe l·∫°i)</p><p>${html}</p>`;
    let accuracy = ((sArr.length - mistakes) / sArr.length) * 100;
    showCert(accuracy > 60 ? 5 : 4, lessons[sel.value].t);
}

function analyzeFree(said) {
    let fixed = said.toLowerCase()
        .replace(/have people/g, "help people")
        .replace(/name is home/g, "name is Hoang")
        .replace(/\bi is\b/g, "I am")
        .replace(/\bshe have\b/g, "she has")
        .replace(/i would like to have/g, "I would like to help");

    document.getElementById('fbContent').innerHTML = `
        <p><b>Con n√≥i:</b> "${said}"</p>
        <div class="suggestion-box">
            <b>üí° C√¥ s·ª≠a l·∫°i cho ƒë√∫ng:</b><br>
            <span style="color:var(--primary); font-weight:bold;">"${fixed}"</span>
        </div>`;
    playVoice(said);
    showCert(5, "Free Speaking");
}

function showCert(stars, title) {
    document.getElementById('cName').innerText = document.getElementById('nameInp').value || "Super Star";
    document.getElementById('cClass').innerText = document.getElementById('classInp').value || "5/...";
    document.getElementById('cUnit').innerText = title;
    document.getElementById('cStars').innerText = "‚≠ê".repeat(stars);
    document.getElementById('cert').style.display = 'block';
}
</script>
</body>
</html>
